<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="stylesheet" href="jquery-ui-widget.css">
<link rel="stylesheet" href="../../node_modules/jquery-ui/themes/redmond/jquery-ui.min.css">
<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../../node_modules/jquery-ui/custom.js"></script>

<dom-module id="jquery-ui-widget">

  <template>
    <div class="myWrapper">
      <div id="jqueryUiWidgetPlaceholder">
        <content></content><!-- pass through content-->
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'jquery-ui-widget',
      properties: {
        name: {
          type: String,
          value: ""
        },
        options: {
          type: Object,
          value: undefined
        },
        id: {
          type: String,
          value: ""// create unique id if not given, polymer properties computed: 'computeFullName(first, last)'
        },
        on: {
          type: String,
          value:""// no default value
        }
      },
      created: function() {

      },
      ready: function () {
        var $widget = this._createWidget();
        this._attachEventHandler($widget);
        //console.log(this.shadowRoot);
        //console.log(this.parentNode);

        var $rootNode = this._getRootNode();
      console.log(this._getAttributes($rootNode));
      },
      _getRootNode(){
        var $rootNode = $(this.parentNode).find("#"+this.id);
        return $rootNode;
      },
      _getAttributes($node){
        return $node[0].attributes;
      },
      _getEventHandler(){

      },
      _createWidget(){
        //var widgetConfigurationObjectString = '{"label":"Hallo Welt"}';
        //var widgetConfigurationObject = JSON.parse(widgetConfigurationObjectString)// maybe i need this again
        var widgetId = this.id;
        var widgetConfigurationObject = this.options;
        var widgetConstructorFunctionName = this.name;
        var $widget = $("#jqueryUiWidgetPlaceholder")[widgetConstructorFunctionName](widgetConfigurationObject);
        $widget.attr("id",widgetId);// give placeholder new id TODO: not performant that way setting id after init
        return $widget;
      },
      _attachEventHandler($widget){
        //var eventName = "click"
        var eventName = this.on;
        var eventHandlerAsString = "function(){alert('servusFromString');}";
        var selfExecutingFunctionString = "("+eventHandlerAsString+")();";
        // execute it TODO: Security Check:-)

        //var eventHandler = function(){alert("jeah");};
        $widget.on(eventName,function(){
          //eventHandler();
          eval(selfExecutingFunctionString);
        });
      }
    });
  </script>
  <style>

  </style>

</dom-module>