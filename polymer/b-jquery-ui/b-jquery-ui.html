<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="stylesheet" href="b-jquery-ui.css">
<link rel="stylesheet" href="../../node_modules/jquery-ui/themes/smoothness/jquery-ui.min.css">
<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../../node_modules/jquery-ui/custom.js"></script>

<dom-module id="b-jquery-ui">

  <template>
    <div class="b-jquery-ui-wrapper">
      <div id="jqueryUiPlaceholder">
        <content></content><!-- pass through content-->
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'b-jquery-ui',
      properties: {
        name: {
          type: String,
          value: ""
        },
        options: {
          type: Object,
          value: undefined
        },
        id: {
          type: String,
          value: ""// create unique id if not given, polymer properties computed: 'computeFullName(first, last)'
        },
        on: {
          type: String,
          value:""// no default value
        }
      },
      created: function() {

      },
      ready: function () {
        var $widget = this._createWidget();
        this._attachEventHandlers($widget);

      },

      _getAttributesStartingWithOnDash(attributesNodeMap){
        // e.g on-click, on-mouseover

        // use jquery map, because attributesNodeMap isn't a real array
        var attributesStartingWithOnDash = $.map(attributesNodeMap,function (attribute) {
          if(attribute.name.indexOf("on-")!==-1){
            return attribute;
          }
        });
        return attributesStartingWithOnDash;
      },

      // TODO: search for better solution to get root node
      _getRootNode(){
        var $rootNode = $(this.parentNode).find("#"+this.id);
        return $rootNode;
      },

      _getAttributes(){
        return this._getRootNode()[0].attributes;
      },

      _getEventHandler(){

      },

      _createWidget(){
        //var widgetConfigurationObjectString = '{"label":"Hallo Welt"}';
        //var widgetConfigurationObject = JSON.parse(widgetConfigurationObjectString)// maybe i need this again
        var widgetId = this.id;
        var widgetConfigurationObject = this.options;
        var widgetConstructorFunctionName = this.name;
        var $widget = $("#jqueryUiPlaceholder")[widgetConstructorFunctionName](widgetConfigurationObject);
        $widget.attr("id",widgetId);// give placeholder new id TODO: not performant that way setting id after init
        return $widget;
      },

      _attachEventHandlers($widget){
        var attributesNodeMap = this._getAttributes();
        var attributesStartingWithOnDash = this._getAttributesStartingWithOnDash(attributesNodeMap);
        for (var i=0;i<attributesStartingWithOnDash.length;i++){
          var attribute = attributesStartingWithOnDash[i];
          // e.g.    on-click ---> ["on-","click"] --> [1]
          var eventName = attribute.name.split("on-")[1];
          var eventHandler = attribute.nodeValue;
          this._attachEventHandler($widget,eventName, eventHandler);
        }
      },

      _attachEventHandler($widget,eventName,eventHandlerAsString){
        //eventName = "click"
        //eventHandlerAsString = "function(){alert('servusFromString');}";
        var selfExecutingFunctionString = "("+eventHandlerAsString+")();";
        // execute it TODO: Security Check:-)
        //var eventHandler = function(){alert("jeah");};
        $widget.on(eventName,function(){
          //eventHandler();
          eval(selfExecutingFunctionString);
        });
      }
    });
  </script>
  <style>

  </style>

</dom-module>